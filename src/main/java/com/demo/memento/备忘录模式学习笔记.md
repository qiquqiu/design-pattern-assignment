# å¤‡å¿˜å½•æ¨¡å¼å­¦ä¹ ç¬”è®°

## ğŸ“– æ¨¡å¼ç†è§£

å¤‡å¿˜å½•æ¨¡å¼ï¼ˆä¹Ÿå«å¿«ç…§æ¨¡å¼ï¼‰çš„æ ¸å¿ƒæ€æƒ³ï¼š**åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€**ï¼Œè¿™æ ·ä»¥åå°±å¯å°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€ã€‚

ç®€å•è¯´å°±æ˜¯ï¼š**å­˜æ¡£å’Œè¯»æ¡£**ã€‚

## ğŸ¯ Git Stash å®ä¾‹ç±»æ¯”

å¤‡å¿˜å½•æ¨¡å¼å°±åƒ Git çš„ `stash` åŠŸèƒ½ï¼š

```
Git Stash                    å¤‡å¿˜å½•æ¨¡å¼
â”œâ”€ git stash push        â†’  caretaker.save(memento)    // ä¿å­˜å½“å‰çŠ¶æ€
â”œâ”€ git stash pop         â†’  caretaker.get()             // æ¢å¤æœ€è¿‘çŠ¶æ€
â”œâ”€ git stash list        â†’  æŸ¥çœ‹æ ˆä¸­çŠ¶æ€æ•°é‡
â””â”€ git stash drop        â†’  ä¸¢å¼ƒæŸä¸ªçŠ¶æ€ï¼ˆå¯ä»¥æ‰©å±•ï¼‰
```

### å®é™…åœºæ™¯å¯¹æ¯”ï¼š
```bash
# Git å·¥ä½œæµç¨‹
git add .                    # æš‚å­˜æ›´æ”¹
git stash push              # ä¿å­˜å½“å‰å·¥ä½œçŠ¶æ€
# ... ç»§ç»­å…¶ä»–å·¥ä½œ ...
git stash pop               # æ¢å¤ä¹‹å‰ä¿å­˜çš„çŠ¶æ€
```

```java
// å¤‡å¿˜å½•æ¨¡å¼å·¥ä½œæµç¨‹
originator.setData("æ–°æ•°æ®");     // ä¿®æ”¹æ•°æ®
caretaker.save(originator.createMemento()); // ä¿å­˜çŠ¶æ€
// ... ç»§ç»­å…¶ä»–æ“ä½œ ...
originator.restore(caretaker.get()); // æ¢å¤ä¿å­˜çš„çŠ¶æ€
```

## ğŸ—ï¸ æ¨¡å¼ç»“æ„ï¼ˆæ ¸å¿ƒéª¨æ¶ï¼‰

### ä¸‰ä¸ªæ ¸å¿ƒè§’è‰²

1. **Originatorï¼ˆå‘èµ·äººï¼‰**
   - éœ€è¦ä¿å­˜çŠ¶æ€çš„å¯¹è±¡
   - åˆ›å»ºå¤‡å¿˜å½•å¯¹è±¡
   - ä½¿ç”¨å¤‡å¿˜å½•æ¢å¤çŠ¶æ€

2. **Mementoï¼ˆå¤‡å¿˜å½•ï¼‰**
   - å­˜å‚¨å‘èµ·äººçš„å†…éƒ¨çŠ¶æ€
   - çŠ¶æ€çš„å¿«ç…§/å¿«ç…§

3. **Caretakerï¼ˆç®¡ç†è€…ï¼‰**
   - è´Ÿè´£ç®¡ç†å¤‡å¿˜å½•å¯¹è±¡
   - ä½¿ç”¨ Stack å®ç°å¤šçŠ¶æ€ç®¡ç†

## ğŸ¨ æ ‡å‡†UMLç±»å›¾

![https://www.runoob.com/design-pattern/memento-pattern.html](https://www.runoob.com/wp-content/uploads/2014/08/memento-20220601-memento.svg)

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     Originator      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ - state: String     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ + SetMemento()      â”‚
    â”‚ + CreateMemento()   â”‚
    â”‚ + RestoreToMemento()â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–²
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      Memento        â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ - state: String     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ + GetState()        â”‚
    â”‚ + SetState()        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–²
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     Caretaker       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ - memento: Memento  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ + GetMemento()      â”‚
    â”‚ + SetMemento()      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“ å›¾è§£è¯´æ˜

è¿™ä¸ªæ ‡å‡†UMLå›¾å±•ç¤ºäº†å¤‡å¿˜å½•æ¨¡å¼çš„ç»å…¸ç»“æ„ï¼š

- **Originatorï¼ˆå‘èµ·äººï¼‰**:
  - è´Ÿè´£åˆ›å»ºå¤‡å¿˜å½• (`CreateMemento()`)
  - å¯ä»¥ä»å¤‡å¿˜å½•æ¢å¤çŠ¶æ€ (`RestoreToMemento()`)
  - å¯ä»¥è®¾ç½®å¤‡å¿˜å½• (`SetMemento()`)

- **Mementoï¼ˆå¤‡å¿˜å½•ï¼‰**:
  - å­˜å‚¨å‘èµ·äººçš„å†…éƒ¨çŠ¶æ€ (`state: String`)
  - æä¾›è·å–å’Œè®¾ç½®çŠ¶æ€çš„æ–¹æ³• (`GetState()`, `SetState()`)

- **Caretakerï¼ˆç®¡ç†è€…ï¼‰**:
  - è´Ÿè´£ä¿å­˜å¤‡å¿˜å½•å¯¹è±¡ (`SetMemento()`)
  - æä¾›è·å–å¤‡å¿˜å½•çš„æ–¹æ³• (`GetMemento()`)
  - ä¸ç›´æ¥æ“ä½œå¤‡å¿˜å½•å†…å®¹ï¼Œåªè´Ÿè´£ç®¡ç†

### ğŸ”— å…³ç³»è¯´æ˜

- **Originator â†’ Memento**: åˆ›å»ºå’Œæ‹¥æœ‰å…³ç³»
- **Caretaker â†’ Memento**: ç®¡ç†å…³ç³»ï¼Œä½†ä¸ç›´æ¥è®¿é—®å†…éƒ¨çŠ¶æ€
- **Memento**: ä¸ºOriginatoræä¾›çŠ¶æ€å­˜å‚¨ï¼Œå¯¹å¤–éšè—ç»†èŠ‚

## ğŸ”„ å·¥ä½œæµç¨‹

### çŠ¶æ€ä¿å­˜è¿‡ç¨‹
```
1. Originator åˆ›å»º Memento
   originator.createMemento()
   â†“
2. Caretaker ä¿å­˜ Memento åˆ° Stack
   caretaker.save(memento)
   â†“
3. Stack æ ˆç»“æ„ï¼š[çŠ¶æ€1, çŠ¶æ€2, çŠ¶æ€3] â† æ ˆé¡¶ï¼ˆæœ€æ–°ï¼‰
```

### çŠ¶æ€æ¢å¤è¿‡ç¨‹
```
1. Caretaker ä» Stack å–å‡º Memento
   caretaker.get()
   â†“
2. Originator ä½¿ç”¨ Memento æ¢å¤çŠ¶æ€
   originator.restore(memento)
   â†“
3. Stack æ ˆç»“æ„ï¼š[çŠ¶æ€1, çŠ¶æ€2] â† æ ˆé¡¶
```

## ğŸ’¡ æ ¸å¿ƒç‰¹å¾

### 1. å°è£…æ€§ä¿æŠ¤
- å¤‡å¿˜å½•å¯¹å‘èµ·äººä»¥å¤–çš„å¯¹è±¡ä¸å¯è§
- åªæœ‰å‘èµ·äººå¯ä»¥è®¿é—®å¤‡å¿˜å½•çš„å†…éƒ¨çŠ¶æ€

### 2. å¤šçŠ¶æ€ç®¡ç†
- ä½¿ç”¨ Stack å®ç°å¤šçº§æ’¤é”€
- åƒæµè§ˆå™¨çš„å†å²è®°å½•åŠŸèƒ½

### 3. çŠ¶æ€å¿«ç…§
- å¤‡å¿˜å½•æ˜¯çŠ¶æ€çš„å¿«ç…§ï¼Œä¸å¯ä¿®æ”¹
- ä¿è¯çŠ¶æ€çš„ä¸€è‡´æ€§

## ğŸ® ä»£ç æ¼”ç¤ºåˆ†æ

### å…³é”®ä»£ç ç‰‡æ®µ

```java
// åˆ›å»ºå¤‡å¿˜å½•ï¼ˆå­˜æ¡£ï¼‰
public Memento createMemento() {
    return new Memento(data);  // åˆ›å»ºçŠ¶æ€å¿«ç…§
}

// æ¢å¤çŠ¶æ€ï¼ˆè¯»æ¡£ï¼‰
public void restore(Memento memento) {
    this.data = memento.getData();  // æ¢å¤æ•°æ®
}

// ç®¡ç†å¤šä¸ªçŠ¶æ€ï¼ˆGit Stash æ•ˆæœï¼‰
private Stack<Memento> mementos = new Stack<>();

public void save(Memento memento) {
    mementos.push(memento);  // push åˆ°æ ˆé¡¶
}

public Memento get() {
    return mementos.pop();   // ä»æ ˆé¡¶å–å‡º
}
```

## ğŸš€ å®é™…åº”ç”¨åœºæ™¯

### 1. æ–‡æœ¬ç¼–è¾‘å™¨
- æ’¤é”€/é‡åšåŠŸèƒ½
- è‡ªåŠ¨ä¿å­˜è‰ç¨¿

### 2. æ¸¸æˆå­˜æ¡£
- ä¿å­˜æ¸¸æˆè¿›åº¦
- å¿«é€Ÿå­˜æ¡£/è¯»æ¡£

### 3. æ•°æ®åº“äº‹åŠ¡
- äº‹åŠ¡å›æ»š
- çŠ¶æ€æ¢å¤

### 4. ç‰ˆæœ¬æ§åˆ¶
- Git stash/checkout
- æ–‡ä»¶ç‰ˆæœ¬ç®¡ç†

## âœ¨ æ¨¡å¼ä¼˜åŠ¿

1. **å°è£…æ€§**ï¼šä¸ç ´åå¯¹è±¡çš„å°è£…æ€§
2. **ç®€åŒ–æ€§**ï¼šå‘èµ·äººæ— éœ€ç®¡ç†çŠ¶æ€ä¿å­˜ç»†èŠ‚
3. **å¯æ‰©å±•**ï¼šæ”¯æŒå¤šçŠ¶æ€ç®¡ç†
4. **å®‰å…¨æ€§**ï¼šå¤‡å¿˜å½•çŠ¶æ€ä¸å¯ä¿®æ”¹

## âš ï¸ ä½¿ç”¨æ³¨æ„

1. **å†…å­˜æ¶ˆè€—**ï¼šå¤§é‡çŠ¶æ€ä¼šå ç”¨å†…å­˜
2. **çŠ¶æ€å®Œæ•´æ€§**ï¼šç¡®ä¿ä¿å­˜çš„çŠ¶æ€æ˜¯å®Œæ•´çš„
3. **å¹¶å‘å®‰å…¨**ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹éœ€è¦æ³¨æ„çº¿ç¨‹å®‰å…¨

## ğŸ“ ä¸ªäººæ€»ç»“

å¤‡å¿˜å½•æ¨¡å¼çš„æ ¸å¿ƒå°±æ˜¯ï¼š**å­˜æ¡£å’Œè¯»æ¡£**ã€‚

é€šè¿‡ `Stack<Memento>` å®ç°äº†ç±»ä¼¼ Git stash çš„å¤šçŠ¶æ€ç®¡ç†ï¼š
- `save()` = `git stash push`ï¼ˆä¿å­˜å½“å‰çŠ¶æ€ï¼‰
- `get()` = `git stash pop`ï¼ˆæ¢å¤æœ€è¿‘çŠ¶æ€ï¼‰
- Stack ç»“æ„å¤©ç„¶æ”¯æŒå¤šçº§æ’¤é”€

è¿™ä¸ªæ¨¡å¼å®Œç¾è§£å†³äº†**å¦‚ä½•ä¿å­˜å’Œæ¢å¤å¯¹è±¡çŠ¶æ€**çš„é—®é¢˜ï¼ŒåŒæ—¶ä¿æŒäº†è‰¯å¥½çš„å°è£…æ€§ï¼